# This is the master orchestrator workflow for the MLOps pipeline.
# It chains together the CI/CD pipeline, model promotion, and Docker deployment.

name: ðŸ¤– Master MLOps Orchestrator

on:
  push:
    branches:
      - main
    paths-ignore:
      - 'README.md'
      - 'docs/**'
  workflow_dispatch:
    inputs:
      reason:
        description: 'Reason for manual execution'
        required: false
        default: 'Manual run to test MLOps pipeline'

# Variables are passed directly via 'secrets' or defined locally.

jobs:
  # Consolidated CI/CD Pipeline (Build, Test, Register, and Push to Docker hub)
  ci_cd_pipeline:
    name: "Consolidated CI/CD (Build, Register, Promote, & Push Docker)"
    # Uses the reusable workflow where all logic is now contained
    uses: ./.github/workflows/ci_pipeline.yml
    with:
      commit_sha: ${{ github.sha }}
    secrets:
      # Pass the secret directly to the reusable workflow
      MLFLOW_TRACKING_URI: ${{ secrets.MLFLOW_TRACKING_URI }}
      DOCKER_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
      DOCKER_PASSWORD: ${{ secrets.DDOCKERHUB_TOKEN }}
